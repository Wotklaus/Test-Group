<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Contentful + Supabase Demo</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(120deg, #f5f8fa 0%, #dbeafe 100%);
      min-height: 100vh;
      font-family: 'Roboto', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 0;
    }
    .container {
      background: #fff;
      padding: 40px 30px;
      border-radius: 22px;
      box-shadow: 0 10px 40px 0 rgba(44,72,171,0.10),
                  0 2px 4px 0 rgba(44,72,171,0.06);
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 450px;
      width: 100%;
    }
    .msg {
      font-size: 1.2em;
      color: #393b3f;
      font-weight: bold;
      margin: 18px 0 0 0;
      text-align: center;
    }
    .title {
      font-family: 'Montserrat', 'Roboto', Arial, sans-serif;
      font-size: 2em;
      font-weight: 700;
      color: #29ca41;
      margin-top: 1em;
      margin-bottom: 0.5em;
      text-align: center;
    }
    .footer {
      font-size: 0.98em;
      color: #4972b8;
      margin-top: 24px;
      opacity: 0.78;
      text-align: center;
    }
    .btn-primary {
      background: #65bdc5;
      color: #fff;
      font-size: 1em;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      margin-top: 14px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background 0.19s;
    }
    .btn-primary:hover {
      background: #183978;
    }
    .results-list {
      margin: 10px 0 0 0;
      padding: 0;
      list-style: none;
      font-size: 1em;
      color: #696b6e;
      text-align: left;
      width: 100%;
    }
    .results-list li {
      padding: 6px 0;
      border-bottom: 1px solid #e3eafe;
    }
    @media (max-width: 600px) {
      .container { padding: 24px 8px; }
      .msg { font-size: 1.08em; }
      .title { font-size: 1.2em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="title" class="title">Loading title...</div>
    <div id="contenido" class="msg">Loading message...</div>
    
    <!-- Button for students -->
    <button id="studentsBtn" class="btn-primary">Show Students</button>
    <ul id="studentsResults" class="results-list"></ul>

    <!-- Button for enrollments -->
    <button id="enrollmentsBtn" class="btn-primary">Show Enrollments</button>
    <ul id="enrollmentsResults" class="results-list"></ul>
    
  </div>
  <script>
    // Fetch Contentful message
    fetch('/api/message')
      .then(res => res.json())
      .then(data => {
        document.getElementById('title').textContent = data.title ?? "No title";
        document.getElementById('contenido').textContent = data.text ?? "No message";
      })
      .catch(e => {
        document.getElementById('contenido').textContent = "There was an error loading the message";
      });

    // Supabase - Students
    document.getElementById('studentsBtn').addEventListener('click', function() {
      const btn = this;
      btn.disabled = true;
      btn.textContent = "Loading...";
      fetch('/api/students')
        .then(response => response.json())
        .then(data => {
          if (Array.isArray(data) && data.length) {
            document.getElementById('studentsResults').innerHTML =
              data.map(student =>
                `<li><b>${student.name}</b> (${student.email})</li>`
              ).join('');
          } else {
            document.getElementById('studentsResults').innerHTML =
              '<li>No students found in Supabase</li>';
          }
        })
        .catch(err => {
          document.getElementById('studentsResults').innerHTML =
            '<li style="color:#a30016">Error fetching students from Supabase</li>';
        })
        .finally(() => {
          btn.disabled = false;
          btn.textContent = 'Show Students';
        });
    });

    // Supabase - Enrollments -
    document.getElementById('enrollmentsBtn').addEventListener('click', function() {
      const btn = this;
      btn.disabled = true;
      btn.textContent = "Loading...";
      fetch('/api/enrollments')
        .then(response => response.json())
        .then(data => {
          if (Array.isArray(data) && data.length) {
            document.getElementById('enrollmentsResults').innerHTML =
              data.map(e =>
                `<li>
                  <b>ID:</b> ${e.id}, 
                  <b>student_id:</b> ${e.student_id}, 
                  <b>course:</b> ${e.course}, 
                  <b>grade:</b> ${e.grade}
                </li>`
              ).join('');
          } else {
            document.getElementById('enrollmentsResults').innerHTML =
              '<li>No enrollments found in Supabase</li>';
          }
        })
        .catch(err => {
          document.getElementById('enrollmentsResults').innerHTML =
            '<li style="color:#a30016">Error fetching enrollments</li>';
        })
        .finally(() => {
          btn.disabled = false;
          btn.textContent = 'Show Enrollments';
        });
    });
  </script>
</body>
</html>